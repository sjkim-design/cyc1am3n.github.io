---
layout: post
title:  "[번역] CTC를 이용한 시퀀스 모델링"
subtitle: "Classifying korean moive review with KoNLPy, nltk, and Keras"
post_description: "음성 인식, 손글씨 인식 등 여러 시퀀스 문제에서 사용되는 알고리즘인 Connectionist Temporal Classification(CTC)의 안내서입니다."
date:   2018-11-14 20:56:54 +0900
tags: [data-science, machine-learning]
background: '/img/posts/ml-with-python/background.png'
author: cyc1am3n
comments: true

---

*음성 인식, 손글씨 인식 등 여러 시퀀스 문제에서 사용되는 알고리즘인 Connectionist Temporal Classification(이하 CTC)의 안내서입니다.*

---

<br />

## 시작하기에 앞서

다음과 같은 상황의 음성 인식 문제를 한 번 생각해봅시다. 우리는 머신러닝 모델에 학습시킬 데이터로 오디오 클립과 그에 해당하는 원고(음성을 글로 옮긴 자료)를 가지고 있습니다. 하지만 우리는 원고의 각 글자가 오디오 클립에 어느 부분에 해당되는지는 모르고 있습니다.

이렇게 문자의 할당을 하지 않고서는, 학습할 수 있는 간단한 방법은 없을 것입니다. "한 글자에 10개의 입력(*여기에서는 오디오 데이터, 예를 들면  time t가 10 변할 만큼의 오디오 데이터*)"라는 규칙을 적용할 수도 있겠지만, 사람의 말하기 속도는 천차만별이고 이런 규칙은 언제나 깨질 수 있기 마련입니다.  다른 방법으로는 자막 파일과 비슷하게, 오디오 클립의 위치에 해당되는 문자를 하나씩 대응시킬 수도 있습니다. 이 방법은 모델링 관점에서는 학습하기에 적합하지만, 데이터셋의 크기가 커진다면 매우 귀찮은 작업일 것입니다.

사실 이런 문제는 음성 인식에서만 적용되는 것이 아니라 다른 곳에서도 볼 수 있습니다. 이미지 또는 펜촉의 위치를 나타내는 시퀀스 데이터를 통한 손글씨 인식이나 비디오에서 나오는 사람의 행동을 예측하는 것이 그 예시입니다. 

CTC는 입력과 출력 사이의 할당을 모를 때 사용할 수 있는 방법입니다. 아래 내용에서 보시겠지만, 이 방법은 특히 음성이나 손글씨 인식에 적합합니다.

---

이번에는 조금 수학적인 표현으로 이 문제를 표현해봅시다.

우리는 오디오 클립에 해당되는 입력 데이터인 시퀀스 $$X=[x_1,x_2,...,x_T]$$ 에 원고에 해당되는 출력 데이터인 시퀀스 $$Y=[y_1,y_2,...,y_U]$$ 를 매핑시켜야 합니다.

간단한 지도 학습 알고리즘을 사용해서 이 문제를 해결하고 싶지만, 여기에는 다음과 같은 몇 가지 어려움이 있습니다.

* 시퀀스 $$X$$와 $$Y$$는 가변적인 길이를 가집니다.
* 시퀀스 $$X$$와 $$Y$$의 비율 또한 변할 수 있습니다.
* 우리는 시퀀스 $$X$$와 $$Y$$ 사이의 정확한 할당 정보를 알지 못합니다.

 CTC 알고리즘은 이런 어려움을 극복할 수 있습니다. CTC는 주어진 $$X$$ 에 대해서 가능한 모든 $$Y$$ 의 분포를 출력합니다. 우리는 이 분포를 이용해 주어진 출력의 확률을 **추론**하거나 **평가**할 수 있습니다.

하지만 손실 함수를 계산하거나 추론하는 모든 방법이 쉬운 것은 아닙니다.  우리는 CTC가 이 두 가지를 효율적으로 수행할 수 있도록 설계해야 합니다.

**손실 함수(Loss Function):** 주어진 입력에 대해서 정답에 해당되는 시퀀스가 출력이 될 확률을 최대로 높여야 합니다. 이를 위해서, 효율적으로 조건부 확률 $$p(Y\;|\;X)$$ 를 계산할 필요가 있습니다. 경사하강법을 사용해야 하므로, 이 함수(확률) $$p(Y\;|\;X)$$는 미분이 가능해야합니다.

**추론하기:** 모델을 학습시키고 나면, 주어진 $$X$$에 대해 $$Y$$를 추론하고 싶을 것 입니다. 이것은
$$
Y^*=\underset{Y}{argmax}\;p(Y\;|\;X)
$$
를 구하는 것을 의미하고, 이상적으로 $$Y^*$$는 효율적으로 찾을 수 있습니다. CTC를 사용하면 비용이 많이 들지 않는 대략적인 해결 방법을 얻을 수 있습니다.

---

<br />

## 알고리즘

CTC 알고리즘을 사용하면 주어진 $$X$$에 대해 어떤 $$Y$$의 확률을 구할 수 있습니다. 확률을 구하는 데에 있어서 중요한 점은 CTC가 입력과 출력 사이의 할당을 구하는 방법입니다. 어떻게 할당 하는지를 보면서 손실 함수와 추론을 하는 과정을 살펴봅시다.

<br />

### 할당

CTC 알고리즘은 따로 입력과 출력 사이에 각 시퀀스의 할당을 할 필요가 없습니다. 그러나 주어진 입력에 대해서 출력의 함수를 구하기 위해서는, CTC가 가능한 모든 할당의 확률을 합해야 합니다. 우리는 손실 함수가 어떻게 계산되는지를 이해하기 위해서 이러한 할당에 대해 이햐를 해야합니다. 

직관적인 이해를 위해 먼저 간단한 예시를 통한 나이브한 접근법을 사용해 보겠습니다. 입력 시퀀스의 크기가 6이고, 그에 해당하는 레이블이 $$Y=[c,\;a,\;t]$$ 라고 해봅시다. $$X$$ 와 $$Y$$ 



---

> ### 원문
>
> Sequence Modeling With CTC (*by [Awni Hannun](http://stanford.edu/~awni/)*): https://distill.pub/2017/ctc/
>
> 오역이 있을 수 있으니, 발견하시면 댓글로 피드백 해주시면 감사하겠습니다. :)